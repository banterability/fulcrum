<!doctype html>
<html lang="en">
<head>
  <style>
    *, *:before, *:after {
      -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
     }
    .bug{background-color: rgba(255, 0, 0, 0.1);}
    .feature{background-color: rgba(0, 255, 0, 0.1);}
    .chore{background-color: rgba(255, 255, 0, 0.1);}
    .story-list{
      display: inline-block;
      vertical-align: top;
      border: 2px solid rgba(0,0,0,0.2);
      margin: 0 5px;
      padding: 5px;
    }
  </style>
</head>
<body>

  <div id="main"></div>
  <div id="filters">
    <a href="javascript:buildList(stories.models);">reset</a>

  </div>

  <script src="vendor/underscore-min.js"></script>
  <script src="vendor/backbone-min.js"></script>

  <script src="stub_api_response.json"></script>

  <script>
    var StoryModel, StoryCollection, stories;

    StoryModel = Backbone.Model.extend({});

    StoryCollection = Backbone.Collection.extend({
      model: StoryModel
    });

    stories = new StoryCollection;

    storyData.stories.forEach(function(story){
      stories.add({
        id: story.id,
        title: story.title,
        type: story.type,
        author: story.author.name,
        authorId: story.author.id
      });
    });
  </script>
  <script>

    var buildList, parentEl;

    var container = document.createElement('div');
    container.classList.add('story-list');

    buildList = function(stories, title){
      var header, list;

      container.innerHTML = "";
      header = document.createElement('p');
      if(title){
        header.textContent = title;
      } else {
        header.textContent = "All Stories:";
      }

      list = document.createElement('ul');
      stories.forEach(function(story){
        var listItem;
        listItem = document.createElement('li');
        listItem.classList.add(story.get('type'));
        listItem.textContent = story.get('title');
        list.appendChild(listItem);
      });

      container.appendChild(header);
      container.appendChild(list);

      return container;
    };

    parentEl = document.getElementById('main');

    parentEl.appendChild(buildList(stories.models));

    var filterBy;

    filterBy = function(collection, key, value){
      criteria = {}
      criteria[key] = value;
      buildList(collection.where(criteria), "Stories where " + key + " = " + value);
    }

    var setupFilters = function(collection){
      filterList = document.getElementById('filters');
      FILTERABLE_ATTRIBUTES = ['author','type'];
      FILTERABLE_ATTRIBUTES.forEach(function(attr){
        var selections = _.uniq(collection.pluck(attr));
        filterList.appendChild(createFilterEl(attr, selections));
      })
    }

    var createFilterEl = function(type, selections){
      var filterContainer = document.createElement('div');
      filterContainer.classList.add('filter-list');

      header = document.createElement('p');
      header.textContent = 'Filter by ' + type + ':';

      listEl = document.createElement('ul');
      selections.forEach(function(option){
        var listItem, link;
        link = document.createElement('a');
        link.href = "javascript:filterBy(stories,'" + type + "','" + option + "');";
        link.textContent = option;

        listItem = document.createElement('li');
        listItem.appendChild(link);

        listEl.appendChild(listItem);
      });

      filterContainer.appendChild(header);
      filterContainer.appendChild(listEl);

      return filterContainer;
    }

    setupFilters(stories);
  </script>
</body>
</html>